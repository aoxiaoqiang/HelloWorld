function handleConnect(e){e?($("#lineInfo").val().trim()?(setStorage("lineInfo",$("#lineInfo").val()),proxy.set(getStorage("lineInfo"))):getStorage("lineInfo")?($("#lineInfo").val(getStorage("lineInfo")),proxy.set(getStorage("lineInfo"))):log("error"),setStorage("state",e),$("[name='my-checkbox']").bootstrapSwitch("state",e),$("#lineInfo").prop("disabled",!0),$("#editLine").removeClass("btn-danger").addClass("btn-primary").text("编辑线路信息")):(proxy.close(),setStorage("state",!1),$("[name='my-checkbox']").bootstrapSwitch("state",!1))}function parseLineInfo(e){var t={};try{var o=e.split(" ");return t.protocal=o[0],t.ip=o[1].split(":")[0],t.port=o[1].split(":")[1],t.state=getStorage("state")||!1,t}catch(e){return"error"}}function initURLstatus(){function e(e){t.text(e);var o="";$.get("../js/rules.json",function(n){for(var a=JSON.parse(n),l=0;l<a.length;l++)if(a[l]==e){o="sys";break}if(log("----"+o),"sys"==o)t.text("系统代理地址"),$(".icon-box .glyphicon-ban-circle").parent().show();else if(getStorage("customRules")&&getStorage("customRules").length>0){for(var i=getStorage("customRules"),r=0,l=0;l<i.length;l++)if(r=l,i[l]==e){o="cus";break}"cus"==o?($(".icon-box .glyphicon-minus-sign").parent().show(),$("#btnHandleURL").click(function(e){e.preventDefault(),i.splice(r,1),setStorage("customRules",i),handleConnect(!0),location.reload()})):($(".icon-box .glyphicon-plus-sign").parent().show(),$("#btnHandleURL").click(function(t){t.preventDefault(),i.push(e),setStorage("customRules",i),handleConnect(!0),location.reload()}))}else $(".icon-box .glyphicon-plus-sign").parent().show(),$("#btnHandleURL").click(function(t){t.preventDefault();var o=[];o.push(e),log(o),setStorage("customRules",o),handleConnect(!0),location.reload()})})}var t=$("#btnHandleURL");chrome.tabs.query({currentWindow:!0,active:!0},function(o){var n=getDomain(o[0].url);0==n?(t.text("禁止操作"),$(".icon-box .glyphicon-ban-circle").parent().show(),t.button("reset")):e(n)})}function payModel(){$("#myModal .modal-body").html('<img class="pay-img" src="../images/pay/alipay.jpg" alt="" />'),$("#myModal").modal()}var extensionId=chrome.runtime.id,proxy=new ChromeProxy,customRules=getStorage("customRules")||[];$("#textVersion").text("v"+chrome.runtime.getManifest().version),$("#lineInfo").val(getStorage("lineInfo")||""),$("[name='my-checkbox']").bootstrapSwitch("state",getStorage("state")||!1),getStorage("state")?activeIcon():grayIcon(),getStorage("debug")&&1==getStorage("debug")&&$(".debug-line").show(),$("#lineInfo").change(function(){setStorage("lineInfo",$(this).val())}),$('input[name="my-checkbox"]').on("switchChange.bootstrapSwitch",function(e,t){setStorage("state",t),log(t),handleConnect(t)}),$("#editLine").click(function(){var e=$("#lineInfo").prop("disabled");log(e),e?($("#lineInfo").prop("disabled",!1).focus(),$(this).removeClass("btn-primary").addClass("btn-danger").text("保存线路信息"),handleConnect(!1)):($("#lineInfo").prop("disabled",!0),$(this).removeClass("btn-danger").addClass("btn-primary").text("编辑线路信息"),handleConnect(!0))}),initURLstatus(),$("#getInfo").click(function(e){if(e.preventDefault(),getStorage("lineInfo")){var t=parseLineInfo(getStorage("lineInfo"));if("error"!=t){var o="";o+='<p class="field"><span>连接状态: </span>'+(1==t.state?"Connected":"Disconnected")+"</p>",o+='<p class="field"><span>协议: </span>'+t.protocal+"</p>",o+='<p class="field"><span>主机地址: </span>'+t.ip+"</p>",o+='<p class="field"><span>端口号: </span>'+t.port+"</p>",$("#myModal .modal-body").html(o)}else $("#myModal .modal-body").html("线路信息有误，请检查线路格式是否正确。正确的行格式:<b> HTTP 127.0.0.1:80 </b>，注意检查是否包含不符合要求的空格。")}else $("#myModal .modal-body").html("暂无代理线路信息!");$("#myModal").modal()}),$("#newTab").click(function(){getStorage("debug")?openTab(location.href,!0):($("#myModal .modal-body").html("请打开调试模式，然后使用这个函数!打开调试模式方法:“关于” -> “调试模式”。"),$("#myModal").modal())}),$("#getMoreLine").click(function(e){e.preventDefault();try{log(proQiong.get());for(var t=proQiong.get(),o="",n=0;n<t.length;n++)o+='<div class="line-box">',o+="<p><span>"+t[n].name+": </span><br/>"+t[n].position+"</p>",o+="</div>";$("#myModal .modal-body").html(o)}catch(e){$("#myModal .modal-body").html("获取线路信息失败，请联系开发者!")}$("#myModal").modal()}),$("#getMoreLine2").click(function(e){e.preventDefault();try{log(proSuperVPN.get());for(var t=proSuperVPN.get(),o="",n=0;n<t.length;n++)o+='<div class="line-box">',o+="<p><span>"+t[n].name+": </span><br/>"+t[n].position+"</p>",o+="</div>";$("#myModal .modal-body").html(o)}catch(e){$("#myModal .modal-body").html("获取线路信息失败，请联系开发者!")}$("#myModal").modal()}),$("#btnResetPlugin").click(function(e){e.preventDefault(),window.localStorage.clear(),proxy.close(function(){$("#myModal .modal-body").html("插件数据重置成功，请重新输入代理服务器信息！"),$("#myModal").modal(),$("#myModal").on("hidden.bs.modal",function(e){location.reload()})})}),$("#btnDisabledPlugin").click(function(e){e.preventDefault(),chrome.management.setEnabled(extensionId,!1,function(){})}),$("#btnAbout").click(function(e){e.preventDefault(),$("#myModal .modal-body").html('&nbsp;&nbsp;&nbsp;&nbsp;此插件仅供交流学习使用，如果您在使用过程中有问题或更好地建议可以及时联系我们。知识无国界，希望大家能共同成长、共同进步。<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;如果您觉得我们做的不错可以小小的<u class="about-pay">支持一下</u>，有了您的支持我们会走的更远！<br/><br/>联系我们<br/>QQ: <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2310005831&site=qq&menu=yes">2310005831</a><br/>Email: <a href="mailto:aoxiaoqiang@163.com?subject=The%20extension%20of%20the%20feedback&body=The%20body%20of%20the%20email" id="openEmail">aoxiaoqiang@163.com</a><br/><br/><div class="debugger"><label><input type="checkbox" '+(getStorage("debug")?'checked="checked"':"")+'id="debugMode"> 调试模式</label></div>'),$("#openEmail").click(function(e){e.preventDefault(),openTab($(this).attr("href"),!0)}),$(".about-pay").click(function(){$("#myModal").modal("hide"),setTimeout(function(){payModel()},400)}),$("#debugMode").change(function(e){setStorage("debug",$(this).prop("checked")),$(this).prop("checked")?$(".debug-line").show():$(".debug-line").hide()}),$("#myModal").modal()}),$("#btnSupport").click(function(e){e.preventDefault(),payModel()});